"""Code Genius (Supervisor) ‚Äî Orchestrates Repo Mapper, Code Analyzer, AI Summaries, and DocGenie.
Stable Jac version using sequential Python execution (no nested defs).
"""

def run_supervisor {
    print("üß© Starting Code Genius (Supervisor)...");

    exec("""
import subprocess
import sys
import os
import shutil

BASE_DIR = os.path.dirname(os.path.abspath(__file__))

# ============================================================
# üßπ Step 0: Clean up cache and temp files
# ============================================================
print('üßπ Cleaning up Jac cache and temporary files...')
for root, dirs, files in os.walk(BASE_DIR):
    for d in dirs:
        if d in ('__pycache__', '.jac_cache'):
            path = os.path.join(root, d)
            try:
                shutil.rmtree(path)
                print(f'   üßΩ Removed cache directory: {path}')
            except Exception as e:
                print(f'   ‚ö†Ô∏è Could not remove {path}: {e}')
    for f in files:
        if f.endswith('.pyc'):
            try:
                os.remove(os.path.join(root, f))
            except Exception as e:
                print(f'   ‚ö†Ô∏è Could not delete {f}: {e}')
print('‚úÖ Cleanup complete.\\n')


# ============================================================
# üîπ Step 1: Repository Mapping
# ============================================================
print('üîπ Step 1: Running repo_mapper.jac...')
subprocess.run(["jac", "run", "repo_mapper.jac"], cwd=BASE_DIR, check=True)
print('‚úÖ repo_mapper.jac completed successfully.')


# ============================================================
# ü§ñ Step 1.5: Repository Summary (Gemini flash)
# ============================================================
print('\\nü§ñ Step 1.5: Generating AI-enhanced repository summary...')
try:
    subprocess.run([sys.executable, "repo_summary.py", "--from-files"], cwd=BASE_DIR, check=False)
    print('‚úÖ Repository summary generated successfully via Gemini.')
except Exception as e:
    print(f'‚ö†Ô∏è Repo summary skipped due to error: {e}')


# ============================================================
# üîπ Step 2: Code Analysis
# ============================================================
print('\\nüîπ Step 2: Running code_analyzer.jac...')
subprocess.run(["jac", "run", "code_analyzer.jac"], cwd=BASE_DIR, check=True)
print('‚úÖ code_analyzer.jac completed successfully.')


# ============================================================
# ü§ñ Step 2.5: Gemini-enhanced Code Summary
# ============================================================
print('\\nü§ñ Step 2.5: Running Gemini AI-enhanced code analysis...')
try:
    subprocess.run([sys.executable, "code_analyzer.py"], cwd=BASE_DIR, check=False)
    print('‚úÖ Gemini AI summary completed and appended to code_analysis.txt')
except Exception as e:
    print(f'‚ö†Ô∏è Gemini summarization skipped due to error: {e}')


# ============================================================
# üîπ Step 3: Documentation Generation
# ============================================================
print('\\nüîπ Step 3: Running doc_generator.jac...')
subprocess.run(["jac", "run", "doc_generator.jac"], cwd=BASE_DIR, check=True)
print('‚úÖ doc_generator.jac completed successfully.')


# ============================================================
# üß© Step 4: Combine Results (delegated to server.py)
# ============================================================
print('\\nüß© Combining results into final_documentation.md...')
subprocess.run([sys.executable, "server.py", "--merge"], cwd=BASE_DIR, check=True)
print('‚úÖ Documentation combined and saved to final_documentation.md')


# ============================================================
# ‚úÖ Summary
# ============================================================
print('\\nüèÅ Supervisor process complete.')
print('----------------------------------')
print('Repo Mapper, Repo Summary, Code Analyzer, Doc Generator, and Gemini Summaries executed successfully.')
print('----------------------------------')
""");

    print("üß† All processes completed successfully.");
    return "Supervisor execution finished.";
}

with entry:__main__ {
    print(f"{run_supervisor()}");
}
